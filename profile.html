<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Profile â€“ Daily Slice</title>
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>

  <!-- same wrapper as Explore/Home -->
  <main class="phone phone--white profile-screen">

    <section class="profile-card" aria-labelledby="profile-username">
      <div class="profile-avatar">
        <img src="assets/icon.png" alt="User avatar" />
      </div>

      <h1 id="profile-username" class="profile-username">
        <p id="profile-username-text">HUNGRY-OWL-2908</p>
        <a href="accountpage.html">
          <img src="assets/pencilicon.png" class="pencil-icon" alt="Edit username">
        </a>
      </h1>

      <div class="profile-streak" aria-label="Daily streak">
        <span class="streak-count" id="scores">26ðŸ”¥</span>
      </div>
    </section>

    <!-- ONLY THIS PART SCROLLS -->
    <div class="profile-scroll">
      <!-- leaderboard placeholder -->
      <div class="leaderboard-placeholder" id="leaderboard"></div>
      <!-- add more sections here; they'll scroll within this area -->
    </div>

    <!-- bottom nav belongs inside the phone frame -->
    <nav class="bottom-nav" aria-label="Main navigation">
      <a href="index.html">
        <img src="assets/polygon.png" alt="Home" class="nav-icon home-icon">
      </a>
      <a href="explore.html">
        <img src="assets/search.png" alt="Search" class="nav-icon search-icon">
      </a>
      <a href="profile.html" aria-current="page">
        <img src="assets/icon.png" alt="Profile" class="nav-icon profile-icon active">
      </a>
    </nav>
    <script type="module">
      import {getFirestore, doc, collection, query, getDoc, onSnapshot, orderBy} from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
      import {onAuthStateChanged, getAuth} from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
      import {db} from "./firebase.js";

      const auth = getAuth();
    onAuthStateChanged(auth, (user) => {
      if (user) {
        const userDocRef = doc(db, "UserAccounts", user.uid);
        onSnapshot(userDocRef, (doc) => {
          if (doc.exists()) {
            const userData = doc.data();
            if (userData.username) {
              document.getElementById('profile-username-text').textContent = `${userData.username}`;
            }
            if (userData.Score !== null) {
              document.getElementById('scores').textContent = `${userData.Score}ðŸ”¥`;
            }
          }
        });
      } else {
        console.log("No user is signed in.");
      }
    });
    
      const q = query(collection(db, "UserAccounts"), orderBy("Score", "desc"));
      onSnapshot(q,(snapshot) => {
        const leaderboard = document.getElementById("leaderboard");
        leaderboard.innerHTML = "";
        snapshot.docs.forEach((doc, index) => {
          const userData = doc.data();
          const entry = document.createElement('div');

          entry.textContent = `${index + 1}. ${userData.username} --- ${userData.Score} pts\n`;
          leaderboard.appendChild(entry);
        });
      });
    </script>
  </main>
  
</body>
</html>
