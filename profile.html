<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile - Daily Slice</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <main class="app-screen">
    <h1 class="page-title">Profile</h1>
    <p class="placeholder">This is where the user profile details will go...</p>
  </main>

  <h2 id="authHeader">Log in/Sign Up</h2>
  <input type="email" id="email" placeholder="Email: " >
  <input type="password" id="password" placeholder="Password: " >
  <button id="signInButton">Log In</button>
  <button id="signUpButton">Sign Up</button>
  <button id="signOutButton" style="display:none;">Sign Out</button>
  <p id="SignInError" style="color: red; display:none;"></p>
  <p id="userStatus">Not signed in</p>


  <nav class="bottom-nav" aria-label="Main navigation">
    <a href="index.html">
      <img src="assets/polygon.png" alt="Home" class="nav-icon home-icon">
    </a>
    <a href="explore.html">
      <img src="assets/search.png" alt="Search" class="nav-icon search-icon">
    </a>
    <a href="profile.html">
      <img src="assets/icon.png" alt="Profile" class="nav-icon profile-icon active">
    </a>
  </nav>
  <script type="module">
      import {auth} from './firebase.js'

      import {createUserWithEmailAndPassword,
              signInWithEmailAndPassword,
              signOut,
              onAuthStateChanged,} from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
      import {getFirestore, doc, setDoc} from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
    window.addEventListener('DOMContentLoaded', () => {
    const db = getFirestore();
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const signUpBtn = document.getElementById('signUpButton');
    const signInBtn = document.getElementById('signInButton');
    const signOutBtn = document.getElementById('signOutButton');
    const userStatus = document.getElementById('userStatus');
    const SignInError = document.getElementById('SignInError');
    signUpBtn.addEventListener('click', async () => {
      try{
        const email = emailInput.value
        const password = passwordInput.value

        const userCredentials = await createUserWithEmailAndPassword(auth, email, password);
        const account = userCredentials

        await setDoc(doc(db, "UserAccounts", account.user.uid), {
          email: auth.currentUser.email,
          Score: 0,
          createdAt: new Date()

        });
        console.log("User signed up:", userCredentials.user);

        signUpButton.style.display = 'none';
        signInButton.style.display = 'none';
        signOutButton.style.display = 'inline';
        userStatus.textContent = `Signed in as: ${userCredentials.user.email}`;
        document.getElementById('authHeader').style.display = 'none';
        document.getElementById('email').style.display = 'none';
        document.getElementById('password').style.display = 'none';
        SignInError.style.display = 'none';
      }catch (error) {
        console.error("Error signing up:", error);
        let message = "Sign up failed. ";
        if (error.code === "auth/email-already-in-use") {
          message += "Email already in use.";
        } else if (error.code === "auth/weak-password") {
          message += "Password should be at least 6 characters.";
        } else if (error.code === "auth/invalid-email") {
          message += "Invalid email address.";
        } else {
          message += error.message;
        }
        SignInError.textContent = message;
        SignInError.style.display = 'block';
        signOutBtn.style.display = 'block';
      };
    });
    signInBtn.addEventListener('click', async () => {
      SignInError.style.display = 'none';
      try{
        const email = emailInput.value
        const password = passwordInput.value

        const userCredentials = await signInWithEmailAndPassword(auth, email, password);
        console.log("User signed in:", userCredentials.user);

        signUpButton.style.display = 'none';
        signInButton.style.display = 'none';
        signOutButton.style.display = 'inline';
        userStatus.textContent = `Signed in as: ${userCredentials.user.email}`;
        document.getElementById('authHeader').style.display = 'none';
        document.getElementById('email').style.display = 'none';
        document.getElementById('password').style.display = 'none';
        SignInError.style.display = 'none';
      }catch (error) {
        console.error("Error signing in:", error);
        let message = "Sign in failed. ";
        if (error.code === "auth/user-not-found" || error.code === "auth/invalid-credential") {
          message += "Invalid email or password.";
        } else if (error.code === "auth/invalid-email") {
          message += "Invalid email address.";
        } else {
          message += error.message;
        }
        SignInError.textContent = message;
        SignInError.style.display = 'block';
        signOutBtn.style.display = 'block';
      };
    });
    signOutBtn.addEventListener('click', async () => {
      try{
        await signOut(auth);
        console.log("User signed out");

        signUpButton.style.display = 'inline';
        signInButton.style.display = 'inline';
        signOutButton.style.display = 'none';
        userStatus.textContent = 'Not signed in';
        document.getElementById('authHeader').style.display = 'block';
        document.getElementById('email').style.display = 'inline';
        document.getElementById('password').style.display = 'inline';
        SignInError.style.display = 'none';
      }catch (error) {
        console.error("Error signing out:", error);
      };
    });

    onAuthStateChanged(auth, (user) => {
      if (user) {
        console.log("User is signed in:", user);
        signUpButton.style.display = 'none';
        signInButton.style.display = 'none';
        signOutButton.style.display = 'inline';
        userStatus.textContent = `Signed in as: ${user.email}`;
        document.getElementById('authHeader').style.display = 'none';
        document.getElementById('email').style.display = 'none';
        document.getElementById('password').style.display = 'none';
        SignInError.style.display = 'none';
      } else {
        console.log("No user is signed in.");
        signUpButton.style.display = 'inline';
        signInButton.style.display = 'inline';
        signOutButton.style.display = 'none';
        userStatus.textContent = 'Not signed in';
        document.getElementById('authHeader').style.display = 'block';
        document.getElementById('email').style.display = 'inline';
        document.getElementById('password').style.display = 'inline';
        SignInError.style.display = 'none';
      }
    });
  })

  </script>
</body>
</html>
    